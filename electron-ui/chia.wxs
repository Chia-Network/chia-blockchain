<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
    <?include "config.wxi"?>
    <Product Name='Chia' 
        Manufacturer='Chia Network'
        Id='*' 
        UpgradeCode='9FF22D37-6167-4F05-A0BC-9B5D8BECAC7E'
        Language='1033' 
        Codepage='1252' 
        Version='$(var.version)'>
        <Package Id='*' 
            Keywords='Installer' 
            Description="Chia Installer $(var.version)"
            Comments='Chia is a registered trademark of the Chia Network' 
            Manufacturer='Chia Network'
            InstallerVersion='100' 
            Languages='1033' 
            Compressed='yes' 
            SummaryCodepage='1252' />
        <Upgrade Id='9FF22D37-6167-4F05-A0BC-9B5D8BECAC7E'>
            <UpgradeVersion OnlyDetect='yes' 
                Property='SELFFOUND'
                Minimum='$(var.version)' 
                IncludeMinimum='yes'
                Maximum='$(var.version)' 
                IncludeMaximum='yes' />
            <UpgradeVersion OnlyDetect='yes' 
                Property='NEWERFOUND'
                Minimum='$(var.version)' 
                IncludeMinimum='no' />
            <UpgradeVersion OnlyDetect='no' 
                Property='PREVIOUSFOUND'
                Minimum='0.1.0' 
                IncludeMinimum='yes'
                Maximum='$(var.version)' 
                IncludeMaximum='no' />                
        </Upgrade>
        <CustomAction Id='AlreadyUpdated' Error='[ProductName] has already been updated to $(var.version) or newer.' />
        <CustomAction Id='NoDowngrade' Error='A later version of [ProductName] is already installed.' />

        <InstallExecuteSequence>
            <Custom Action='AlreadyUpdated' After='FindRelatedProducts'>SELFFOUND</Custom>
            <Custom Action='NoDowngrade' After='FindRelatedProducts'>NEWERFOUND</Custom>
            <RemoveExistingProducts Before="InstallInitialize" />            
        </InstallExecuteSequence>        

        <Media Id='1' Cabinet='chia.cab' EmbedCab='yes' DiskPrompt="CD-ROM #1" />
        <Icon Id="icon.ico" SourceFile="icon.ico"/>
        <Property Id="ARPPRODUCTICON" Value="icon.ico" />        
        <Property Id='DiskPrompt' Value="Chia Network's Chia Installation [1]" />

        <UIRef Id="WixUI_Minimal" />
        <UIRef Id="WixUI_ErrorProgressText" />

        <Directory Id='TARGETDIR' Name='SourceDir'>
            <Directory Id='ProgramFilesFolder' Name='PFiles'>
                <Directory Id='ChiaNetwork' Name='Chia Network'>
                    <Directory Id='INSTALLDIR' Name='Chia Wallet'/>
                </Directory>
            </Directory>
            <Directory Id="ProgramMenuFolder" Name="Programs">
                <Directory Id="ProgramMenuDir" Name="Chia">
                    <Component Id="ProgramMenuDir" Guid="0B8A0D75-657A-4FFC-84E8-8D40B343E7CA">
                        <Shortcut Id="ProgramMenuShortcut" 
                            Name="Chia"
                            Description="Chia $(var.version)"
                            Target="[INSTALLDIR]$(var.exename)"
                            WorkingDirectory="INSTALLDIR"
                            Icon="icon.ico"/>                    
                        <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
                        <RegistryValue Root='HKCU' 
                            Key='Software\[Manufacturer]\[ProductName]' 
                            Type='string' 
                            Value='' 
                            KeyPath='yes' />
                    </Component>
                </Directory>
            </Directory>

            <Directory Id="DesktopFolder" Name="Desktop" >
                <Component Id="DesktopShortCut" Guid="4281DF51-82FC-471B-A26A-1292DFEE9738">
                    <Shortcut Id="ApplicationDesktopShortcut" 
                        Name="Chia"
                        Description="Chia $(var.version)"
                        Target="[INSTALLDIR]$(var.exename)"
                        WorkingDirectory="INSTALLDIR"
                        Icon="icon.ico"/>
                    <RemoveFolder Id="DesktopFolder" On="uninstall"/>
                    <RegistryValue Root='HKCU' 
                        Key='Software\[Manufacturer]\[ProductName]'
                        Name='installed' 
                        Type='string' 
                        Value='1' 
                        KeyPath='yes' />                        
                </Component>
            </Directory>
        </Directory>

        <Feature Id='Complete' Level='1'>
            <ComponentRef Id='DesktopShortCut' />
            <ComponentRef Id='ProgramMenuDir' />
            <ComponentGroupRef Id="ChiaFiles" />            
        </Feature>
    </Product>
</Wix>
