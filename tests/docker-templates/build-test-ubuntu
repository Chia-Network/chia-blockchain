version: "3.3"

services:
  pytest:
    sysctls:
      - "net.ipv6.conf.all.disable_ipv6=0"
    image: chia-test
    network_mode: bridge
    environment:
      - PYVER
      - CHIAPROFILE
      - PYTHONUNBUFFERED=1
    volumes:
      - CHIAHOME:/app
    command: ["sudo", "bash", "-c", ". /py/venv${PYVER}/bin/activate ; if [ -z \"${CHIAPROFILE}\" ] ; then pytest --durations 0 TEST_DIR ; else python3 -m cProfile -o profile -m pytest --durations 0 TEST_DIR ; fi"]
